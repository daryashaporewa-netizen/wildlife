# Проектный практикум. Обнаружение и подсчёт диких животных по фотографиям (YOLOv8)

## Тема

«Автоматическое обнаружение и подсчёт крупных диких животных (буйволов, слонов, носорогов и зебр)  
на фотографиях африканской саванны с использованием предобученной модели YOLO».

Такой выбор темы обоснован практической значимостью:

- подсчёт популяций и мониторинг динамики численности — одна из ключевых задач экологии и охраны дикой природы;
- ручной просмотр фотоловушек и снимков с дронов занимает много времени и ресурсов;
- автоматизация этой части позволяет ускорить анализ и уменьшить влияние человеческого фактора.

## Область задачи и постановка в DS-терминах

**Область:** компьютерное зрение (Computer Vision)  
**Подзадача:** обнаружение объектов (Object Detection) и последующий подсчёт количества объектов на изображении.

### Перевод в термины Data Science

**Входные данные**

- цветные изображения животных в натуральной среде (формат JPG/PNG);
- каждый объект на изображении размечен в формате YOLO:
  - класс `c ∈ {buffalo, elephant, rhino, zebra}`;
  - координаты прямоугольника, ограничивающего объект (bounding box).

**Модель**

- предобученная нейросеть YOLOv8n из библиотеки `ultralytics`;
- дообучается на выбранном датасете под задачу детекции животных.

**Основная задача**

- задача обнаружения объектов (object detection) с несколькими классами;
- тип задачи: многоклассовая детекция с локализацией (multi-class object detection).

**Целевая переменная**

- для детекции: класс объекта + координаты bounding box’а;
- для подсчёта: общее количество объектов на изображении  
  (можно считать «любых классов» или по каждому классу отдельно).

**Оценка качества**

- для детекции — `mAP@0.5`, `mAP@0.5:0.95`, `precision`, `recall` по классам;
- для подсчёта — `MAE` и `MAPE` между реальным числом объектов на кадре и количеством детекций модели.

## Данные

Для обучения и тестирования модели используется открытый датасет:

- **Object Detection – Wildlife Dataset (YOLO Format)**
- Площадка: Kaggle  
- Автор: `ankanghosh651`  
- Ссылка на датасет:  
  https://www.kaggle.com/datasets/ankanghosh651/object-detection-wildlife-dataset-yolo-format

В ноутбуке данные скачиваются через Kaggle API, распаковываются в директорию  
`/content/wildlife_yolo/final_data` и далее используются для обучения и оценки модели YOLOv8n.

## Как устроено решение

Весь код и комментарии находятся в ноутбуке **`wildlife_yolo.ipynb`**.

Основные шаги:

1. **Настройка окружения и Kaggle API**
   - установка необходимых библиотек (`kaggle`, `ultralytics`, `numpy`, `matplotlib`, `pyyaml`);
   - создание файла `kaggle.json` и скачивание датасета в `/content/wildlife_yolo`.

2. **Разведка структуры датасета**
   - вывод корневых директорий;
   - поиск папок `images` и `labels`;
   - просмотр нескольких примеров файлов с изображениями и разметкой.

3. **Подготовка конфигурации YOLO**
   - чтение исходного `data_wl.yaml`;
   - замена путей `path`, `train`, `val`, `test` на локальные;
   - сохранение исправленного файла `data_wl_local.yaml`.

4. **Обучение модели YOLOv8n**
   - запуск обучения с помощью `YOLO("yolov8n.pt").train(...)` на нашем датасете;
   - сохранение результатов и лучших весов в папку проекта  
     `/content/wildlife_yolo_project/yolov8n_wildlife_v1/weights/best.pt`.

5. **Визуальная проверка предсказаний**
   - загрузка обученной модели;
   - прогон нескольких валидационных изображений;
   - отрисовка исходного кадра с предсказанными bounding boxes и подписями классов.

6. **Оценка качества на тестовом наборе**
   - стандартная валидация через `model.val(split="test")` с расчётом:
     - `mAP@0.5`,
     - `mAP@0.5:0.95`,
     - средние `precision` и `recall`;
   - дополнительная функция, которая:
     - по разметке считает реальное количество объектов на кадре;
     - по предсказаниям считает число детекций;
     - по всем тестовым изображениям считает `MAE` и `MAPE` для задачи подсчёта.

## Результаты

Цифры приведены по тестовому набору (`test/images` и `test/labels`).

### Качество детекции

- `mAP@0.5` ≈ **0.944**
- `mAP@0.5:0.95` ≈ **0.762**
- `precision` ≈ **0.93**
- `recall` ≈ **0.877**

Интерпретация:

- модель почти не даёт ложных срабатываний (высокий precision);
- пропускает сравнительно мало объектов (recall около 0.88);
- усреднённое качество по всем IoU-порогам (`mAP@0.5:0.95`) на хорошем уровне для компактной модели YOLOv8n;
- по отдельным классам (buffalo, elephant, rhino, zebra) значения mAP находятся в одном диапазоне — сильного перекоса в пользу одного вида нет.

### Качество подсчёта животных

- `MAE` ≈ **0.245** объекта/кадр  
- `MAPE` ≈ **9.94 %**

То есть:

- в среднем модель ошибается меньше чем на четверть животного на изображение  
  (обычно число детекций совпадает с разметкой или отличается на 1 объект);
- относительная ошибка около 10 %, что для реальных полевых снимков с разной дальностью и ракурсами выглядит разумным уровнем.

**Общее заключение**

В рамках практикума удалось:

- поднять и дообучить готовую модель YOLO под свою задачу;
- добиться высокого качества детекции животных на тестовом наборе;
- показать, что эту же модель можно использовать для оценки численности животных на фотографиях с небольшой средней ошибкой.


## Как запустить / воспроизвести эксперимент

### Вариант 1. Только посмотреть работу модели

1. Открыть ноутбук `wildlife_yolo.ipynb` в Google Colab.
2. Запустить ячейки от блока с тестированием модели (проверка предсказаний и оценка метрик).
3. Получить:
   - визуализации с bounding box’ами на изображениях;
   - значения метрик `mAP@0.5`, `mAP@0.5:0.95`, `precision`, `recall`, `MAE`, `MAPE`.

(Этот вариант подходит, если данные уже скачаны и модель обучена в текущей сессии Colab.)

### Вариант 2. Полное воспроизведение (скачивание данных + обучение)

1. Открыть `wildlife_yolo.ipynb` в Google Colab.
2. Создать Kaggle API-токен (Kaggle → Account → Create New API Token) и настроить доступ
   в ноутбуке по инструкциям в первых ячейках.
3. Последовательно выполнить все ячейки сверху вниз:
   - скачивание датасета `Object Detection – Wildlife Dataset (YOLO Format)` с Kaggle;
   - проверка структуры папок `train/valid/test` и файлов `images/labels`;
   - установка библиотеки `ultralytics` (YOLOv8);
   - правка `data_wl.yaml` и сохранение локальной конфигурации `data_wl_local.yaml`;
   - обучение модели YOLOv8n на датасете wildlife;
   - тестирование модели на валидационном и тестовом наборах;
   - вычисление метрик `mAP`, `precision`, `recall`, `MAE`, `MAPE`.
4. В конце ноутбука посмотреть блок с краткими выводами по качеству детекции и подсчёта.




## Структура репозитория

- `wildlife_yolo.ipynb` — основной ноутбук с кодом:
  - загрузка данных с Kaggle;
  - обучение YOLOv8n;
  - тестирование и расчёт метрик.
- `README.md` — описание проекта, постановка задачи, ссылка на датасет и результаты.
